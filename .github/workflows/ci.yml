name: CI
on:
  pull_request:
  push:
  workflow_dispatch:
jobs:
  test:
    runs-on: "${{ matrix.os }}"
    timeout-minutes: 20
    strategy:
      fail-fast: false
      matrix:
        os:
        - "ubuntu-latest"
        - "macos-latest"
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with:
        node-version: "18.15.0"
    - run: |
       npm install
       ./node_modules/.bin/prettier --write "./sources/main.js" "./sources/index.html"
       git diff --exit-code
    - uses: actions/setup-java@v4
      with:
        java-version: 17
        distribution: temurin
    - uses: coursier/cache-action@v6
    - run: scutil --set HostName "$(scutil --get LocalHostName).local"
    - run: wget https://raw.githubusercontent.com/dwijnand/sbt-extras/cd57b2815147dafa2b0c661a54607c245de4de58/sbt
    - run: chmod +x ./sbt
    - run: ./sbt -v
           scalafmtSbtCheck
           scalafmtCheckAll
           updateClassifiers
           test
           copyFilesFull
    - if: ${{ github.ref == 'refs/heads/main' && github.event_name == 'push' && github.repository_owner == 'xuwei-k' && matrix.os == 'ubuntu-latest' }}
      uses: JamesIves/github-pages-deploy-action@v4.6.0
      with:
        branch: gh-pages
        folder: sources
        clean: true
